<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bus Travel E-commerce Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=Material+Icons" rel="stylesheet" />
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: #f9fafb;
    color: #1e293b;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  a {
    color: inherit;
    text-decoration: none;
  }
  button {
    cursor: pointer;
    font-family: inherit;
  }
  img {
    max-width: 100%;
    height: auto;
    display: block;
  }

  /* Container grid layout */
  .app-container {
    display: grid;
    grid-template-columns: 300px 1fr 350px;
    grid-template-rows: auto 1fr;
    grid-template-areas:
      "header header header"
      "filter main cart";
    height: 100vh;
  }

  /* Sticky header */
  header.app-header {
    grid-area: header;
    background: linear-gradient(135deg, #7c3aed, #3b82f6);
    color: white;
    padding: 0 24px;
    position: sticky;
    top: 0;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 100;
    box-shadow: 0 4px 8px rgb(124 58 237 / 0.3);
  }

  .logo {
    font-weight: 900;
    font-size: 1.5rem;
    letter-spacing: 0.04em;
    user-select: none;
  }
  /* Search bar */
  .search-bar {
    flex: 1;
    margin: 0 16px;
    position: relative;
  }
  .search-bar input {
    width: 100%;
    padding: 10px 40px 10px 16px;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    transition: box-shadow 0.3s ease;
  }
  .search-bar input:focus {
    outline: none;
    box-shadow: 0 0 8px rgba(124, 58, 237, 0.7);
  }
  .material-icons.search-icon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #7c3aed;
    font-size: 24px;
    pointer-events: none;
  }

  /* Navigation */
  nav.top-nav {
    display: flex;
    gap: 24px;
    align-items: center;
  }
  nav.top-nav a.nav-link {
    font-weight: 600;
    font-size: 1rem;
    padding: 8px 12px;
    border-radius: 8px;
    transition: background 0.3s ease;
  }
  nav.top-nav a.nav-link:hover,
  nav.top-nav a.nav-link.active {
    background: rgba(255 255 255 / 0.3);
  }

  /* Cart icon with count */
  .cart-icon {
    position: relative;
    color: white;
    font-size: 28px;
    cursor: pointer;
  }
  .cart-badge {
    position: absolute;
    top: -6px;
    right: -10px;
    background: #ef4444;
    color: white;
    font-weight: 700;
    font-size: 12px;
    min-width: 20px;
    height: 20px;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 6px;
  }

  /* Left sidebar filter */
  aside.filter-sidebar {
    grid-area: filter;
    padding: 24px;
    border-right: 1px solid #e2e8f0;
    background: white;
    display: flex;
    flex-direction: column;
    gap: 24px;
    overflow-y: auto;
  }

  aside.filter-sidebar h2 {
    font-weight: 900;
    font-size: 1.25rem;
    margin-bottom: 12px;
    color: #4c1d95;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .filter-group label {
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
  }
  .filter-group input[type="checkbox"],
  .filter-group input[type="radio"] {
    accent-color: #7c3aed;
  }

  /* Price slider */
  .price-range {
    display: flex;
    gap: 8px;
    align-items: center;
    font-weight: 600;
    font-size: 0.9rem;
  }
  .price-range input[type="number"] {
    width: 80px;
    padding: 6px 10px;
    border-radius: 8px;
    border: 1px solid #cbd5e1;
    font-size: 0.925rem;
  }

  /* Clear filters button */
  .btn-clear-filters {
    background: #a78bfa;
    color: white;
    font-weight: 700;
    padding: 8px 16px;
    border: none;
    border-radius: 12px;
    transition: background 0.3s ease;
  }
  .btn-clear-filters:hover {
    background: #7c3aed;
  }


  /* Main product grid */
  main.product-main {
    grid-area: main;
    background: #f9fafb;
    padding: 24px;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }

  /* Sorting and pagination bar */
  .product-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }
  .sort-select {
    padding: 8px 12px;
    font-size: 1rem;
    border-radius: 12px;
    border: 1px solid #cbd5e1;
    background: white;
    color: #1e293b;
  }
  .pagination {
    display: flex;
    gap: 12px;
  }
  .pagination button {
    background: white;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    padding: 6px 12px;
    font-weight: 600;
    color: #4b5563;
    transition: background 0.3s ease, color 0.3s ease;
  }
  .pagination button:hover:not(:disabled) {
    background: #7c3aed;
    color: white;
    border-color: #7c3aed;
  }
  .pagination button:disabled {
    opacity: 0.5;
    cursor: default;
  }

  /* Product cards grid */
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    gap: 24px;
  }

  /* Product card with hover and scale */
  .product-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 8px rgb(0 0 0 / 0.08);
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.3s ease, transform 0.3s ease;
    position: relative;
  }
  .product-card:hover {
    box-shadow: 0 12px 24px rgb(124 58 237 / 0.3);
    transform: translateY(-6px);
    z-index: 10;
  }
  .product-image-wrapper {
    position: relative;
    padding-top: 56.25%; /* 16:9 ratio */
    border-radius: 16px 16px 0 0;
    overflow: hidden;
  }
  .product-image-wrapper img {
    position: absolute;
    top: 0; bottom: 0; left: 0; right: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  .product-card:hover .product-image-wrapper img {
    transform: scale(1.05);
  }

  /* Quick view button floating top right */
  .quick-view-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    background: rgba(124, 58, 237, 0.8);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    color: white;
    font-size: 24px;
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .product-card:hover .quick-view-btn {
    opacity: 1;
  }

  /* Product details */
  .product-info {
    padding: 16px 20px 24px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex-grow: 1;
  }
  .product-name {
    font-weight: 700;
    font-size: 1.1rem;
    line-height: 1.3;
    color: #4b0082;
  }
  .product-description {
    font-size: 0.9rem;
    color: #6b7280;
    flex-grow: 1;
  }
  .price-row {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .price {
    font-weight: 800;
    font-size: 1.2rem;
    color: #7c3aed;
  }
  .old-price {
    text-decoration: line-through;
    color: #9ca3af;
    font-weight: 600;
    font-size: 0.9rem;
  }
  /* Discount badge */
  .discount-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: #ef4444;
    color: white;
    font-weight: 700;
    font-size: 0.75rem;
    border-radius: 12px;
    padding: 4px 10px;
    user-select: none;
  }
  /* Rating stars */
  .star-rating {
    display: flex;
    gap: 2px;
  }
  .star-rating .material-icons {
    font-size: 18px;
    color: #facc15; /* yellow */
  }

  /* Add to cart button */
  .add-to-cart-btn {
    margin-top: auto;
    padding: 10px 0;
    background: #7c3aed;
    border: none;
    border-radius: 12px;
    color: white;
    font-weight: 700;
    font-size: 1rem;
    transition: background 0.3s ease;
  }
  .add-to-cart-btn:hover {
    background: #5b21b6;
  }

  /* Right sidebar cart */
  aside.cart-sidebar {
    grid-area: cart;
    background: white;
    border-left: 1px solid #e2e8f0;
    padding: 24px;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow-y: auto;
  }
  aside.cart-sidebar h2 {
    font-weight: 900;
    font-size: 1.25rem;
    color: #4c1d95;
    margin-bottom: 20px;
    user-select: none;
  }
  .cart-items {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow-y: auto;
    margin-bottom: 20px;
  }
  .cart-item {
    display: flex;
    gap: 16px;
    padding: 12px;
    background: #f9fafb;
    border-radius: 12px;
    align-items: center;
  }
  .cart-item img {
    width: 72px;
    height: 56px;
    object-fit: cover;
    border-radius: 12px;
    flex-shrink: 0;
  }
  .cart-item-details {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .cart-item-name {
    font-weight: 700;
    font-size: 1rem;
    color: #4c1d95;
  }
  .cart-item-variant {
    font-size: 0.85rem;
    color: #6b7280;
  }
  .cart-item-price {
    font-weight: 700;
    color: #7c3aed;
  }
  .quantity-controls {
    display: flex;
    gap: 6px;
    align-items: center;
  }
  .quantity-btn {
    background: #7c3aed;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: 700;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .quantity-btn:disabled {
    background: #d8b4fe;
    cursor: default;
  }
  .quantity-display {
    min-width: 24px;
    text-align: center;
    font-weight: 700;
  }
  .remove-item-btn {
    background: none;
    border: none;
    color: #ef4444;
    font-size: 22px;
    cursor: pointer;
  }

  /* Cart summary */
  .cart-summary {
    border-top: 1px solid #e2e8f0;
    padding-top: 16px;
  }
  .summary-row {
    display: flex;
    justify-content: space-between;
    font-weight: 700;
    font-size: 1rem;
    margin-bottom: 8px;
  }
  .checkout-btn {
    width: 100%;
    background: #7c3aed;
    color: white;
    font-weight: 900;
    border: none;
    border-radius: 16px;
    padding: 14px;
    font-size: 1.1rem;
    box-shadow: 0 6px 12px rgb(124 58 237 / 0.4);
    transition: background 0.3s ease;
  }
  .checkout-btn:disabled {
    background: #c4b5fd;
    cursor: default;
    box-shadow: none;
  }
  .checkout-btn:hover:not(:disabled) {
    background: #5b21b6;
  }

  /* Quick view modal */
  .modal {
    position: fixed;
    inset: 0;
    background: rgb(0 0 0 / 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
  }
  .modal.show {
    opacity: 1;
    pointer-events: auto;
  }
  .modal-content {
    background: white;
    border-radius: 20px;
    max-width: 900px;
    width: 90vw;
    max-height: 80vh;
    overflow-y: auto;
    padding: 24px;
    box-shadow: 0 12px 40px rgba(124, 58, 237, 0.2);
    display: flex;
    gap: 24px;
  }
  .modal-close {
    position: absolute;
    top: 12px;
    right: 12px;
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #7c3aed;
    font-weight: 900;
    user-select: none;
  }
  /* Modal left gallery */
  .modal-gallery {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .modal-main-image {
    width: 100%;
    height: 320px;
    border-radius: 20px;
    overflow: hidden;
  }
  .modal-main-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .modal-thumbnails {
    display: flex;
    gap: 12px;
  }
  .modal-thumbnail {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid transparent;
    cursor: pointer;
  }
  .modal-thumbnail.selected {
    border-color: #7c3aed;
  }
  .modal-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Modal right details */
  .modal-details {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 18px;
  }
  .modal-product-name {
    font-weight: 900;
    font-size: 1.7rem;
    color: #4c1d95;
  }
  .modal-price {
    font-weight: 900;
    font-size: 1.4rem;
    color: #7c3aed;
  }
  .modal-old-price {
    font-weight: 700;
    font-size: 1rem;
    color: #9ca3af;
    text-decoration: line-through;
    margin-left: 12px;
  }
  .modal-rating {
    display: flex;
    gap: 6px;
    align-items: center;
  }
  .modal-rating .material-icons {
    color: #facc15;
  }
  .modal-description {
    font-size: 1rem;
    color: #374151;
    line-height: 1.5;
  }
  .modal-variant-select {
    font-size: 1rem;
    padding: 8px 12px;
    border-radius: 12px;
    border: 1px solid #cbd5e1;
  }
  .modal-quantity-row {
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
  }
  .modal-add-cart-btn {
    margin-top: auto;
    background: #7c3aed;
    border: none;
    border-radius: 16px;
    padding: 14px;
    font-weight: 900;
    color: white;
    font-size: 1.2rem;
    transition: background 0.3s ease;
  }
  .modal-add-cart-btn:hover {
    background: #5b21b6;
  }

  /* Footer for mobile only */
  footer {
    display: none;
  }

  /* Responsive design */
  @media (max-width: 1140px) {
    .app-container {
      grid-template-columns: 260px 1fr 320px;
    }
  }
  @media (max-width: 960px) {
    .app-container {
      grid-template-columns: 1fr 320px;
      grid-template-areas:
        "header header"
        "main cart";
    }
    aside.filter-sidebar {
      display: none;
    }
  }
  @media (max-width: 640px) {
    .app-container {
      grid-template-columns: 1fr;
      grid-template-areas:
        "header"
        "main";
    }
    aside.cart-sidebar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      top: auto;
      height: 360px;
      max-height: 50vh;
      border-left: none;
      border-top: 1px solid #e2e8f0;
      box-shadow: 0 -6px 12px rgb(124 58 237 / 0.15);
      background: white;
      transition: transform 0.3s ease;
      transform: translateY(100%);
      z-index: 1500;
      padding: 16px 24px 24px;
      border-radius: 16px 16px 0 0;
    }
    aside.cart-sidebar.visible {
      transform: translateY(0);
    }
    .cart-toggle-btn {
      position: fixed;
      bottom: 72px;
      right: 24px;
      background: #7c3aed;
      border-radius: 50%;
      width: 54px;
      height: 54px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 6px 12px rgb(124 58 237 / 0.3);
      cursor: pointer;
      z-index: 1600;
      color: white;
      font-size: 30px;
    }
  }
</style>
</head>
<body>
<div class="app-container" id="app">
  <header class="app-header">
    <div class="logo" aria-label="Bus Travels Shop Logo" tabindex="0">Bus Travels</div>
    <div class="search-bar" role="search">
      <input type="search" placeholder="Search buses, tours, companies..." aria-label="Search products" id="searchInput" autocomplete="off" />
      <span class="material-icons search-icon">search</span>
    </div>
    <nav class="top-nav" role="navigation" aria-label="Primary navigation">
      <a class="nav-link active" href="#" data-page="products">Products</a>
      <a class="nav-link" href="#" data-page="orders">My Orders</a>
      <a class="nav-link" href="#" data-page="account">Account</a>
      <a class="nav-link" href="#" data-page="wishlist">Wishlist</a>
    </nav>
    <div class="cart-icon" role="button" aria-label="Open shopping cart" tabindex="0" id="cartToggleBtn">
      <span class="material-icons">shopping_cart</span>
      <div class="cart-badge" id="cartCount">0</div>
    </div>
  </header>

  <aside class="filter-sidebar" aria-label="Product filters" id="filterSidebar">
    <h2>Filters</h2>

    <!-- Categories -->
    <section class="filter-group" aria-label="Bus categories">
      <h3>Categories</h3>
      <label><input type="checkbox" name="category" value="Bus Tours" /> Bus Tours</label>
      <label><input type="checkbox" name="category" value="Luxury Buses" /> Luxury Buses</label>
      <label><input type="checkbox" name="category" value="Charter Buses" /> Charter Buses</label>
      <label><input type="checkbox" name="category" value="Shuttle Services" /> Shuttle Services</label>
    </section>

    <!-- Price -->
    <section class="filter-group" aria-label="Filter by price">
      <h3>Price Range ($)</h3>
      <div class="price-range">
        <input type="number" id="minPrice" aria-label="Minimum price" min="0" value="0" />
        <span>to</span>
        <input type="number" id="maxPrice" aria-label="Maximum price" min="0" value="1000" />
      </div>
    </section>

    <!-- Ratings -->
    <section class="filter-group" aria-label="Filter by rating">
      <h3>Minimum Rating</h3>
      <label><input type="radio" name="rating" value="0" checked /> Any</label>
      <label><input type="radio" name="rating" value="4" /> 4 stars & up</label>
      <label><input type="radio" name="rating" value="3" /> 3 stars & up</label>
      <label><input type="radio" name="rating" value="2" /> 2 stars & up</label>
      <label><input type="radio" name="rating" value="1" /> 1 star & up</label>
    </section>

    <!-- Brands -->
    <section class="filter-group" aria-label="Filter by brand">
      <h3>Bus Companies</h3>
      <label><input type="checkbox" name="brand" value="LuxBus Co." /> LuxBus Co.</label>
      <label><input type="checkbox" name="brand" value="GreenRide" /> GreenRide</label>
      <label><input type="checkbox" name="brand" value="CityShuttle" /> CityShuttle</label>
      <label><input type="checkbox" name="brand" value="PremiumLine" /> PremiumLine</label>
    </section>

    <button class="btn-clear-filters" id="clearFiltersBtn">Clear Filters</button>
  </aside>

  <main class="product-main" id="mainContent" tabindex="0" aria-live="polite" aria-relevant="additions removals">
    <div class="product-controls">
      <label for="sortSelect">Sort by:</label>
      <select id="sortSelect" class="sort-select" aria-label="Sort products">
        <option value="popularity">Popularity</option>
        <option value="priceLow">Price: Low to High</option>
        <option value="priceHigh">Price: High to Low</option>
        <option value="rating">Rating</option>
        <option value="newest">Newest</option>
      </select>

      <div class="pagination" aria-label="Pagination controls" id="paginationControls">
        <!-- pagination buttons added dynamic -->
      </div>
    </div>
    <section class="product-grid" id="productGrid" aria-label="Bus products">
      <!-- Product cards injected with JS -->
    </section>
  </main>

  <aside class="cart-sidebar" role="complementary" aria-label="Shopping cart" id="cartSidebar" tabindex="-1">
    <h2>Shopping Cart</h2>
    <div class="cart-items" id="cartItemsContainer" aria-live="polite" aria-relevant="additions removals">
      <!-- Cart items injected here -->
    </div>

    <div class="cart-summary" aria-label="Cart summary">
      <div class="summary-row">
        <span>Subtotal:</span>
        <span id="cartSubtotal">$0.00</span>
      </div>
      <div class="summary-row">
        <span>Shipping:</span>
        <span id="cartShipping">$0.00</span>
      </div>
      <div class="summary-row" style="font-size: 1.25rem; font-weight: 900; border-top: 1px solid #a78bfa; padding-top: 8px;">
        <span>Total:</span>
        <span id="cartTotal">$0.00</span>
      </div>
    </div>
    <button class="checkout-btn" id="checkoutBtn" disabled aria-disabled="true" aria-label="Proceed to checkout">Checkout</button>
  </aside>

  <button class="cart-toggle-btn" id="cartToggleMobileBtn" aria-label="Toggle cart sidebar" hidden>
    <span class="material-icons">shopping_cart</span>
  </button>

  <!-- Quick view modal -->
  <div class="modal" id="quickViewModal" role="dialog" aria-modal="true" aria-labelledby="quickViewTitle" aria-describedby="quickViewDesc" tabindex="-1">
    <div class="modal-content">
      <button class="modal-close" id="modalCloseBtn" aria-label="Close quick view">&times;</button>
      <div class="modal-gallery" id="modalGallery">
        <div class="modal-main-image" id="modalMainImage">
          <!-- main image inserted by JS -->
        </div>
        <div class="modal-thumbnails" id="modalThumbnails">
          <!-- thumbnail images inserted by JS -->
        </div>
      </div>
      <div class="modal-details" id="modalDetails">
        <!-- product details inserted by JS -->
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  'use strict';

  // Sample data structure as per requirements, simplified for demo
  const products = [
    {
      id: 'bus1',
      name: 'Luxury City Tour Bus',
      description: 'Comfortable luxury bus offering panoramic city tours with air conditioning and refreshments.',
      price: 120,
      oldPrice: 150,
      images: [
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/663e7d45-2d0f-4bef-846e-035db66152ec.png',
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/f153d60d-50c3-4ca2-b809-006c056adb00.png',
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/4a232ecc-a50e-4d55-bafc-09dd5fc59beb.png',
      ],
      category: 'Bus Tours',
      brand: 'LuxBus Co.',
      rating: 4.7,
      reviews: [],
      stock: 5,
      variants: [
        { id: 'v1', name: 'Standard Seat', price: 120 },
        { id: 'v2', name: 'Premium Seat', price: 160 }
      ],
      tags: ['luxury', 'city', 'air conditioned'],
      popularity: 87,
      createdAt: '2023-05-25'
    },
    {
      id: 'bus2',
      name: 'Eco-Friendly Shuttle',
      description: 'GreenRide eco-friendly shuttle offering comfortable transfers with environmentally friendly fuel.',
      price: 40,
      oldPrice: null,
      images: [
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/61fe7572-7b4e-4837-b4da-7b60a221e0c8.png',
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/78c7e6f6-2609-46ed-93c0-1e2d5d945793.png',
      ],
      category: 'Shuttle Services',
      brand: 'GreenRide',
      rating: 4.3,
      reviews: [],
      stock: 12,
      variants: [
        { id: 'v1', name: 'Standard Shuttle', price: 40 },
        { id: 'v2', name: 'Express Shuttle', price: 60 }
      ],
      tags: ['green', 'shuttle', 'express'],
      popularity: 54,
      createdAt: '2023-06-10'
    },
    {
      id: 'bus3',
      name: 'Charter Bus for Groups',
      description: 'Spacious charter buses available for group travels to events and trips with customizable features.',
      price: 350,
      oldPrice: 400,
      images: [
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/cb9d4a22-f6fa-4d2b-9f88-160e23171905.png',
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/5d01312c-ccb9-44c1-ae87-d5f77cafe972.png',
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/8041ca0e-bbf0-4aac-8aa6-759bf2b61237.png',
      ],
      category: 'Charter Buses',
      brand: 'PremiumLine',
      rating: 4.9,
      reviews: [],
      stock: 3,
      variants: [
        { id: 'v1', name: 'Standard Charter', price: 350 },
        { id: 'v2', name: 'Deluxe Charter', price: 450 }
      ],
      tags: ['group', 'charter', 'spacious'],
      popularity: 120,
      createdAt: '2023-05-05'
    },
    {
      id: 'bus4',
      name: 'City Shuttle Service',
      description: 'Reliable city shuttle providing frequent and timely connections with comfortable seating.',
      price: 25,
      oldPrice: null,
      images: [
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/57e75a83-84bb-47dc-a859-adf600a75818.png',
        'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/f7a589e1-4d97-4f9c-add6-c1f656163f5f.png',
      ],
      category: 'Shuttle Services',
      brand: 'CityShuttle',
      rating: 3.9,
      reviews: [],
      stock: 18,
      variants: [
        { id: 'v1', name: 'Standard Shuttle', price: 25 },
      ],
      tags: ['city', 'shuttle', 'reliable'],
      popularity: 65,
      createdAt: '2023-06-22'
    },
    // More products can be added for pagination demo
  ];

  // Will hold the cart items with id, productId, variantId, quantity, price, addedAt
  let cart = [];

  let filteredProducts = [...products]; // For filtering and rendering
  let currentPage = 1;
  const productsPerPage = 6;

  // For quick view modal
  let quickViewProduct = null;
  let quickViewSelectedImageIndex = 0;

  // DOM references
  const productGrid = document.getElementById('productGrid');
  const cartItemsContainer = document.getElementById('cartItemsContainer');
  const cartCountEl = document.getElementById('cartCount');
  const cartSubtotalEl = document.getElementById('cartSubtotal');
  const cartShippingEl = document.getElementById('cartShipping');
  const cartTotalEl = document.getElementById('cartTotal');
  const checkoutBtn = document.getElementById('checkoutBtn');
  const filterSidebar = document.getElementById('filterSidebar');
  const searchInput = document.getElementById('searchInput');
  const sortSelect = document.getElementById('sortSelect');
  const paginationControls = document.getElementById('paginationControls');
  const clearFiltersBtn = document.getElementById('clearFiltersBtn');
  const cartSidebar = document.getElementById('cartSidebar');
  const cartToggleBtn = document.getElementById('cartToggleBtn');
  const cartToggleMobileBtn = document.getElementById('cartToggleMobileBtn');

  const quickViewModal = document.getElementById('quickViewModal');
  const modalCloseBtn = document.getElementById('modalCloseBtn');
  const modalGallery = document.getElementById('modalGallery');
  const modalMainImage = document.getElementById('modalMainImage');
  const modalThumbnails = document.getElementById('modalThumbnails');
  const modalDetails = document.getElementById('modalDetails');

  // Helper to format price
  const formatPrice = (price) => {
    return `$${price.toFixed(2)}`;
  };

  // Show cart notification (simple alert for prototype)
  function showCartNotification(productName) {
    // For demo: simple transient notification or console log
    console.log(`Added "${productName}" to cart.`);
  }

  // Add to cart logic from spec (with quantity default 1)
  function addToCart(productId, variantId, quantity = 1) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    const variant = product.variants?.find(v => v.id === variantId);
    const price = variant?.price ?? product.price;

    // Check stock
    const totalQtyInCart = cart.reduce((acc, item) => (item.productId === productId && item.variantId === variantId) ? acc + item.quantity : acc, 0);
    if (totalQtyInCart + quantity > product.stock) {
      alert('Sorry, not enough stock available.');
      return;
    }

    const existing = cart.find(item => item.productId === productId && item.variantId === variantId);
    if (existing) {
      existing.quantity += quantity;
    } else {
      cart.push({
        id: crypto.randomUUID(),
        productId,
        variantId,
        quantity,
        price,
        addedAt: new Date().toISOString()
      });
    }
    updateCartUI();
    showCartNotification(product.name);
    saveCartToStorage();
    if (window.innerWidth <= 640) {
      // Show cart sidebar on mobile after adding
      toggleMobileCart(true);
    }
  }

  // Remove item from cart by id
  function removeCartItem(id) {
    cart = cart.filter(item => item.id !== id);
    updateCartUI();
    saveCartToStorage();
  }

  // Change quantity for cart item by id
  function changeCartItemQuantity(id, newQuantity) {
    if (newQuantity <= 0) {
      removeCartItem(id);
      return;
    }
    const item = cart.find(i => i.id === id);
    if (!item) return;
    const product = products.find(p => p.id === item.productId);
    if (!product) return;
    if (newQuantity > product.stock) {
      alert('Sorry, not enough stock available.');
      return;
    }
    item.quantity = newQuantity;
    updateCartUI();
    saveCartToStorage();
  }

  // Update cart UI
  function updateCartUI() {
    // Update cart count badge
    const totalQuantity = cart.reduce((sum, i) => sum + i.quantity, 0);
    cartCountEl.textContent = totalQuantity;
    cartCountEl.style.display = totalQuantity > 0 ? 'flex' : 'none';
    checkoutBtn.disabled = totalQuantity === 0;
    checkoutBtn.setAttribute('aria-disabled', totalQuantity === 0 ? 'true' : 'false');

    // Clear container
    cartItemsContainer.innerHTML = '';

    let subtotal = 0;
    let shippingCost = 0;

    cart.forEach(item => {
      const product = products.find(p => p.id === item.productId);
      const variant = product?.variants?.find(v => v.id === item.variantId);
      if (!product) return;

      const name = product.name;
      const variantName = variant?.name ?? '';
      const price = variant?.price ?? product.price;
      subtotal += price * item.quantity;

      const itemEl = document.createElement('div');
      itemEl.className = 'cart-item';

      const img = document.createElement('img');
      img.src = product.images[0];
      img.alt = name + ' image';

      const detailsDiv = document.createElement('div');
      detailsDiv.className = 'cart-item-details';

      const nameEl = document.createElement('div');
      nameEl.className = 'cart-item-name';
      nameEl.textContent = name;

      const variantEl = document.createElement('div');
      variantEl.className = 'cart-item-variant';
      variantEl.textContent = variantName;

      const priceEl = document.createElement('div');
      priceEl.className = 'cart-item-price';
      priceEl.textContent = formatPrice(price * item.quantity);

      detailsDiv.appendChild(nameEl);
      detailsDiv.appendChild(variantEl);
      detailsDiv.appendChild(priceEl);

      const qtyControls = document.createElement('div');
      qtyControls.className = 'quantity-controls';

      const btnDecrease = document.createElement('button');
      btnDecrease.className = 'quantity-btn';
      btnDecrease.setAttribute('aria-label', `Decrease quantity of ${name}`);
      btnDecrease.textContent = '-';
      btnDecrease.disabled = item.quantity <= 1;
      btnDecrease.addEventListener('click', () => changeCartItemQuantity(item.id, item.quantity - 1));

      const qtyDisplay = document.createElement('div');
      qtyDisplay.className = 'quantity-display';
      qtyDisplay.textContent = item.quantity;

      const btnIncrease = document.createElement('button');
      btnIncrease.className = 'quantity-btn';
      btnIncrease.setAttribute('aria-label', `Increase quantity of ${name}`);
      btnIncrease.textContent = '+';
      btnIncrease.disabled = item.quantity >= product.stock;
      btnIncrease.addEventListener('click', () => changeCartItemQuantity(item.id, item.quantity + 1));

      qtyControls.appendChild(btnDecrease);
      qtyControls.appendChild(qtyDisplay);
      qtyControls.appendChild(btnIncrease);

      const btnRemove = document.createElement('button');
      btnRemove.className = 'remove-item-btn';
      btnRemove.setAttribute('aria-label', `Remove ${name} from cart`);
      btnRemove.title = `Remove ${name} from cart`;
      btnRemove.innerHTML = 'Ã—';
      btnRemove.addEventListener('click', () => removeCartItem(item.id));

      itemEl.appendChild(img);
      itemEl.appendChild(detailsDiv);
      itemEl.appendChild(qtyControls);
      itemEl.appendChild(btnRemove);

      cartItemsContainer.appendChild(itemEl);
    });

    // Shipping calculation (simulate simple flat rate or free over $200)
    shippingCost = subtotal > 200 || subtotal === 0 ? 0 : 15;
    cartSubtotalEl.textContent = formatPrice(subtotal);
    cartShippingEl.textContent = formatPrice(shippingCost);
    cartTotalEl.textContent = formatPrice(subtotal + shippingCost);
  }

  // Render products to grid
  function renderProducts(page = 1) {
    const start = (page - 1) * productsPerPage;
    const end = start + productsPerPage;
    const pageProducts = filteredProducts.slice(start, end);

    productGrid.innerHTML = '';
    if (pageProducts.length === 0) {
      productGrid.innerHTML = '<p style="font-weight: 700; font-size:1.2rem; color:#6b7280;">No products found.</p>';
      paginationControls.innerHTML = '';
      return;
    }
    pageProducts.forEach(p => {
      const card = createProductCard(p);
      productGrid.appendChild(card);
    });
    renderPagination();
  }

  // Create product card element
  function createProductCard(product) {
    const card = document.createElement('article');
    card.className = 'product-card';
    card.setAttribute('tabindex', '0');
    card.setAttribute('role', 'region');
    card.setAttribute('aria-label', `Product: ${product.name}`);

    // Discount badge if price oldPrice
    if (product.oldPrice && product.oldPrice > product.price) {
      const discountPercent = Math.round(100 * (product.oldPrice - product.price) / product.oldPrice);
      const discountBadge = document.createElement('div');
      discountBadge.className = 'discount-badge';
      discountBadge.textContent = `-${discountPercent}%`;
      card.appendChild(discountBadge);
    }

    const imgWrapper = document.createElement('div');
    imgWrapper.className = 'product-image-wrapper';
    const img = document.createElement('img');
    img.src = product.images[0];
    img.alt = product.name + ' main image';
    imgWrapper.appendChild(img);

    // Quick view button
    const quickViewBtn = document.createElement('button');
    quickViewBtn.className = 'quick-view-btn';
    quickViewBtn.setAttribute('aria-label', `Quick view of ${product.name}`);
    quickViewBtn.innerHTML = '<span class="material-icons">visibility</span>';
    quickViewBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      openQuickView(product.id);
    });
    imgWrapper.appendChild(quickViewBtn);

    const infoDiv = document.createElement('div');
    infoDiv.className = 'product-info';

    const nameEl = document.createElement('h3');
    nameEl.className = 'product-name';
    nameEl.textContent = product.name;

    const descEl = document.createElement('p');
    descEl.className = 'product-description';
    descEl.textContent = product.description;

    const priceRow = document.createElement('div');
    priceRow.className = 'price-row';
    const priceEl = document.createElement('span');
    priceEl.className = 'price';
    priceEl.textContent = formatPrice(product.price);
    priceRow.appendChild(priceEl);
    if (product.oldPrice && product.oldPrice > product.price) {
      const oldPrice = document.createElement('span');
      oldPrice.className = 'old-price';
      oldPrice.textContent = formatPrice(product.oldPrice);
      priceRow.appendChild(oldPrice);
    }

    // Rating stars
    const ratingDiv = document.createElement('div');
    ratingDiv.className = 'star-rating';
    const roundedRating = Math.round(product.rating);
    for (let i = 1; i <= 5; i++) {
      const star = document.createElement('span');
      star.className = 'material-icons';
      star.textContent = i <= roundedRating ? 'star' : 'star_outline';
      ratingDiv.appendChild(star);
    }

    // Add to cart button (adds default first variant or product)
    const addBtn = document.createElement('button');
    addBtn.className = 'add-to-cart-btn';
    addBtn.textContent = 'Add to Cart';
    addBtn.addEventListener('click', () => {
      const variantId = product.variants?.[0]?.id ?? null;
      addToCart(product.id, variantId);
    });

    infoDiv.appendChild(nameEl);
    infoDiv.appendChild(descEl);
    infoDiv.appendChild(priceRow);
    infoDiv.appendChild(ratingDiv);
    infoDiv.appendChild(addBtn);

    card.appendChild(imgWrapper);
    card.appendChild(infoDiv);

    return card;
  }

  // Render pagination buttons
  function renderPagination() {
    const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
    paginationControls.innerHTML = '';
    if (totalPages <= 1) return;

    // Previous button
    const prevBtn = document.createElement('button');
    prevBtn.textContent = 'Prev';
    prevBtn.disabled = currentPage === 1;
    prevBtn.addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderProducts(currentPage);
        window.scrollTo({top: 0, behavior: 'smooth'});
      }
    });
    paginationControls.appendChild(prevBtn);

    // Page numbers (only for first, last and current and neighbors for brevity)
    for (let i = 1; i <= totalPages; i++) {
      if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = i;
        pageBtn.disabled = i === currentPage;
        pageBtn.addEventListener('click', () => {
          currentPage = i;
          renderProducts(i);
          window.scrollTo({top: 0, behavior: 'smooth'});
        });
        paginationControls.appendChild(pageBtn);
      } else if (i === currentPage - 2 || i === currentPage + 2) {
        const dots = document.createElement('span');
        dots.textContent = '...';
        dots.style.padding = '0 8px';
        paginationControls.appendChild(dots);
      }
    }

    // Next button
    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Next';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.addEventListener('click', () => {
      if (currentPage < totalPages) {
        currentPage++;
        renderProducts(currentPage);
        window.scrollTo({top: 0, behavior: 'smooth'});
      }
    });
    paginationControls.appendChild(nextBtn);
  }

  // Filtering logic based on sidebar inputs and search
  function filterProducts() {
    const searchTerm = searchInput.value.trim().toLowerCase();
    const checkedCategories = Array.from(filterSidebar.querySelectorAll('input[name="category"]:checked')).map(i => i.value);
    const minPriceVal = parseFloat(document.getElementById('minPrice').value) || 0;
    const maxPriceVal = parseFloat(document.getElementById('maxPrice').value) || Infinity;
    const ratingVal = parseFloat(filterSidebar.querySelector('input[name="rating"]:checked').value) || 0;
    const checkedBrands = Array.from(filterSidebar.querySelectorAll('input[name="brand"]:checked')).map(i => i.value);

    filteredProducts = products.filter(p => {
      // Search filter: match if name or description or tags include search term
      const matchesSearch = !searchTerm ||
        p.name.toLowerCase().includes(searchTerm) ||
        p.description.toLowerCase().includes(searchTerm) ||
        (p.tags && p.tags.some(t => t.toLowerCase().includes(searchTerm)));

      // Category filter
      const matchesCategory = checkedCategories.length === 0 || checkedCategories.includes(p.category);

      // Price filter (lowest variant price or product price)
      const minVariantPrice = p.variants ? Math.min(...p.variants.map(v => v.price)) : p.price;
      const maxVariantPrice = p.variants ? Math.max(...p.variants.map(v => v.price)) : p.price;
      const priceInRange = (minVariantPrice >= minPriceVal && maxVariantPrice <= maxPriceVal) || (p.price >= minPriceVal && p.price <= maxPriceVal);

      // Ratings filter
      const matchesRating = p.rating >= ratingVal;

      // Brand filter
      const matchesBrand = checkedBrands.length === 0 || checkedBrands.includes(p.brand);

      return matchesSearch && matchesCategory && priceInRange && matchesRating && matchesBrand;
    });

    // Sorting
    const sortValue = sortSelect.value;
    if (sortValue === 'priceLow') {
      filteredProducts.sort((a, b) => a.price - b.price);
    } else if (sortValue === 'priceHigh') {
      filteredProducts.sort((a, b) => b.price - a.price);
    } else if (sortValue === 'rating') {
      filteredProducts.sort((a, b) => b.rating - a.rating);
    } else if (sortValue === 'newest') {
      filteredProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    } else if (sortValue === 'popularity') {
      filteredProducts.sort((a, b) => (b.popularity ?? 0) - (a.popularity ?? 0));
    }

    currentPage = 1;
    renderProducts();
  }

  // Clear all filters
  function clearFilters() {
    filterSidebar.querySelectorAll('input[name="category"]').forEach(i => i.checked = false);
    filterSidebar.querySelectorAll('input[name="brand"]').forEach(i => i.checked = false);
    filterSidebar.querySelector('input[name="rating"][value="0"]').checked = true;
    document.getElementById('minPrice').value = '0';
    document.getElementById('maxPrice').value = '1000';
    searchInput.value = '';
    sortSelect.value = 'popularity';
    filterProducts();
  }

  // Quick view modal open
  function openQuickView(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    quickViewProduct = product;
    quickViewSelectedImageIndex = 0;
    renderQuickViewModal();
    showModal();
  }

  // Render quick view modal content
  function renderQuickViewModal() {
    if (!quickViewProduct) return;
    // Render main image
    modalMainImage.innerHTML = '';
    const mainImg = document.createElement('img');
    mainImg.src = quickViewProduct.images[quickViewSelectedImageIndex];
    mainImg.alt = `Image ${quickViewSelectedImageIndex+1} of ${quickViewProduct.name}`;
    modalMainImage.appendChild(mainImg);

    // Render thumbnails
    modalThumbnails.innerHTML = '';
    quickViewProduct.images.forEach((src, idx) => {
      const thumb = document.createElement('div');
      thumb.className = 'modal-thumbnail' + (idx === quickViewSelectedImageIndex ? ' selected' : '');
      const img = document.createElement('img');
      img.src = src;
      img.alt = `Thumbnail ${idx+1} of ${quickViewProduct.name}`;
      thumb.appendChild(img);
      thumb.tabIndex = 0;
      thumb.setAttribute('role', 'button');
      thumb.setAttribute('aria-label', `Select image ${idx + 1}`);
      thumb.addEventListener('click', () => {
        quickViewSelectedImageIndex = idx;
        renderQuickViewModal();
      });
      thumb.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          quickViewSelectedImageIndex = idx;
          renderQuickViewModal();
        }
      });
      modalThumbnails.appendChild(thumb);
    });

    // Render details
    modalDetails.innerHTML = '';
    const title = document.createElement('h2');
    title.id = 'quickViewTitle';
    title.className = 'modal-product-name';
    title.textContent = quickViewProduct.name;

    const ratingDiv = document.createElement('div');
    ratingDiv.className = 'modal-rating';
    const roundedRating = Math.round(quickViewProduct.rating);
    for (let i = 1; i <= 5; i++) {
      const star = document.createElement('span');
      star.className = 'material-icons';
      star.textContent = i <= roundedRating ? 'star' : 'star_outline';
      ratingDiv.appendChild(star);
    }

    const desc = document.createElement('p');
    desc.id = 'quickViewDesc';
    desc.className = 'modal-description';
    desc.textContent = quickViewProduct.description;

    const priceRow = document.createElement('div');
    priceRow.style.display = 'flex';
    priceRow.style.alignItems = 'center';
    priceRow.style.gap = '12px';

    const price = document.createElement('span');
    price.className = 'modal-price';
    price.textContent = formatPrice(quickViewProduct.price);
    priceRow.appendChild(price);

    if (quickViewProduct.oldPrice && quickViewProduct.oldPrice > quickViewProduct.price) {
      const oldPrice = document.createElement('span');
      oldPrice.className = 'modal-old-price';
      oldPrice.textContent = formatPrice(quickViewProduct.oldPrice);
      priceRow.appendChild(oldPrice);
    }

    // Variant select if applicable
    let variantSelect = null;
    if (quickViewProduct.variants && quickViewProduct.variants.length > 0) {
      variantSelect = document.createElement('select');
      variantSelect.className = 'modal-variant-select';
      variantSelect.setAttribute('aria-label', 'Select variant');
      quickViewProduct.variants.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v.id;
        opt.textContent = `${v.name} (${formatPrice(v.price)})`;
        variantSelect.appendChild(opt);
      });
    }

    // Quantity controls
    const qtyRow = document.createElement('div');
    qtyRow.className = 'modal-quantity-row';
    qtyRow.textContent = 'Quantity: ';
    const qtyInput = document.createElement('input');
    qtyInput.type = 'number';
    qtyInput.min = 1;
    qtyInput.max = quickViewProduct.stock;
    qtyInput.value = 1;
    qtyInput.style.width = '64px';
    qtyInput.style.borderRadius = '8px';
    qtyInput.style.fontSize = '1rem';
    qtyInput.style.padding = '6px 10px';
    qtyRow.appendChild(qtyInput);

    // Add to cart button
    const addCartBtn = document.createElement('button');
    addCartBtn.className = 'modal-add-cart-btn';
    addCartBtn.textContent = 'Add to Cart';
    addCartBtn.addEventListener('click', () => {
      const variantId = variantSelect ? variantSelect.value : (quickViewProduct.variants?.[0]?.id ?? null);
      const qty = parseInt(qtyInput.value, 10);
      if (qty < 1 || qty > quickViewProduct.stock) {
        alert(`Please select quantity between 1 and ${quickViewProduct.stock}`);
        return;
      }
      addToCart(quickViewProduct.id, variantId, qty);
      closeModal();
    });

    modalDetails.appendChild(title);
    modalDetails.appendChild(ratingDiv);
    modalDetails.appendChild(desc);
    modalDetails.appendChild(priceRow);
    if (variantSelect) modalDetails.appendChild(variantSelect);
    modalDetails.appendChild(qtyRow);
    modalDetails.appendChild(addCartBtn);
  }

  // Show modal
  function showModal() {
    quickViewModal.classList.add('show');
    quickViewModal.focus();
  }

  // Close modal
  function closeModal() {
    quickViewModal.classList.remove('show');
    quickViewProduct = null;
  }

  // Toggle cart sidebar on mobile
  function toggleMobileCart(show) {
    if (show) {
      cartSidebar.classList.add('visible');
      cartSidebar.setAttribute('aria-hidden', 'false');
    } else {
      cartSidebar.classList.remove('visible');
      cartSidebar.setAttribute('aria-hidden', 'true');
    }
  }

  // Save cart to localStorage for persistence
  function saveCartToStorage() {
    localStorage.setItem('busShopCart', JSON.stringify(cart));
  }

  // Load cart from localStorage
  function loadCartFromStorage() {
    try {
      const saved = localStorage.getItem('busShopCart');
      if (saved) {
        cart = JSON.parse(saved);
      }
    } catch {
      cart = [];
    }
  }

  // Event listeners
  function setupEventListeners() {
    // Filter change update
    filterSidebar.addEventListener('change', () => {
      filterProducts();
    });

    searchInput.addEventListener('input', debounce(() => {
      filterProducts();
    }, 300));

    sortSelect.addEventListener('change', () => {
      filterProducts();
    });

    clearFiltersBtn.addEventListener('click', () => {
      clearFilters();
    });

    // Cart toggle desktop
    cartToggleBtn.addEventListener('click', () => {
      const isVisible = cartSidebar.classList.contains('visible');
      if (window.innerWidth > 640) {
        if (isVisible) {
          cartSidebar.style.display = 'none';
          cartSidebar.classList.remove('visible');
        } else {
          cartSidebar.style.display = 'flex';
          cartSidebar.classList.add('visible');
        }
      } else {
        toggleMobileCart(!isVisible);
      }
    });

    // Cart toggle mobile button
    cartToggleMobileBtn.addEventListener('click', () => {
      const isVisible = cartSidebar.classList.contains('visible');
      toggleMobileCart(!isVisible);
    });

    // Modal close buttons
    modalCloseBtn.addEventListener('click', () => closeModal());
    quickViewModal.addEventListener('click', (e) => {
      if (e.target === quickViewModal) closeModal();
    });
    // Accessibility: close modal with ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && quickViewModal.classList.contains('show')) {
        closeModal();
      }
    });

    // Navigation page links (stub for future)
    document.querySelectorAll('nav.top-nav a.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        // For prototype, we only have products page implemented
        alert(`Page "${link.textContent}" is not implemented in this demo.`);
      });
    });

    // Checkout button stub
    checkoutBtn.addEventListener('click', () => {
      if (cart.length === 0) return;
      alert('Checkout process is not implemented in this demo.');
    });

    // Responsive cart toggle on resize
    window.addEventListener('resize', () => {
      if (window.innerWidth > 640) {
        cartSidebar.style.display = 'flex';
        cartSidebar.classList.add('visible');
        cartToggleMobileBtn.hidden = true;
      } else {
        cartSidebar.style.display = 'none';
        cartSidebar.classList.remove('visible');
        cartToggleMobileBtn.hidden = false;
      }
    });

    // Initialize responsive state
    if (window.innerWidth <= 640) {
      cartSidebar.style.display = 'none';
      cartSidebar.classList.remove('visible');
      cartToggleMobileBtn.hidden = false;
    } else {
      cartSidebar.style.display = 'flex';
      cartSidebar.classList.add('visible');
      cartToggleMobileBtn.hidden = true;
    }
  }

  // Debounce helper
  function debounce(func, wait) {
    let timeout;
    return (...args) => {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    }
  }

  // Initialize app
  function init() {
    loadCartFromStorage();
    updateCartUI();
    filterProducts();
    setupEventListeners();
  }

  init();

})();
</script>
</body>
</html>

